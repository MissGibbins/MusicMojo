<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MusicMojo - Firebase Test</title>
<style>
  body { font-family: sans-serif; margin: 20px; }
  button { padding: 8px 14px; margin: 5px; cursor: pointer; }
  #classSelector { margin-right: 10px; }
</style>
</head>
<body>
  <h1>MusicMojo</h1>

  <label for="classSelector">Select Class:</label>
  <select id="classSelector"></select>
  <button id="newClass">+ New Class</button>

  <ul id="studentList"></ul>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js"></script>

  <script>
    // ----- Replace these with your Firebase project config -----
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const classSelector = document.getElementById("classSelector");
    const newClassBtn = document.getElementById("newClass");
    const studentList = document.getElementById("studentList");

    let classes = {};
    let currentClass = "";

    // ----- Load classes from Firestore -----
    async function loadClasses() {
      const snapshot = await db.collection("classes").get();
      classes = {};
      snapshot.forEach(doc => classes[doc.id] = doc.data().students || []);
      buildDropdown();
    }

    // ----- Build class dropdown -----
    function buildDropdown() {
      classSelector.innerHTML = "";
      Object.keys(classes).forEach(cls => {
        const option = document.createElement("option");
        option.value = cls;
        option.textContent = cls;
        classSelector.appendChild(option);
      });

      if (Object.keys(classes).length > 0) {
        currentClass = classSelector.value = Object.keys(classes)[0];
        renderStudents();
      }
    }

    // ----- Render students list -----
    function renderStudents() {
      studentList.innerHTML = "";
      const students = classes[currentClass] || [];
      students.forEach(s => {
        const li = document.createElement("li");
        li.textContent = s.name;
        studentList.appendChild(li);
      });
    }

    // ----- Dropdown change -----
    classSelector.addEventListener("change", () => {
      currentClass = classSelector.value;
      renderStudents();
    });

    // ----- New Class button -----
    newClassBtn.addEventListener("click", async () => {
      const name = prompt("Enter new class name:");
      if (!name || classes[name]) {
        alert("Invalid name or class already exists!");
        return;
      }

      // Add new class to Firestore
      await db.collection("classes").doc(name).set({ students: [] });

      // Update local object and dropdown
      classes[name] = [];
      currentClass = name;
      buildDropdown();
      alert(`Class "${name}" created!`);
    });

    loadClasses();
  </script>
</body>
</html>
