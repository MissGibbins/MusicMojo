<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MusicMojo</title>
<style>
  body { font-family: sans-serif; margin: 20px; }
  header { display: flex; align-items: center; margin-bottom: 10px; }
  header img { height: 100px; margin-right: 20px; }
  header h1 { font-size: 32px; margin: 0; }
  #classSelector { margin-bottom: 20px; }
  #canvas { position: relative; width: 100%; height: 600px; border: 2px dashed #ccc; }
  .student { width: 100px; height: 80px; background-color: #22C55F; color: white; display: flex; justify-content: center; align-items: center; cursor: grab; user-select: none; position: absolute; flex-direction: column; border-radius: 8px; font-size: 18px; text-align: center; padding: 10px; }
  .yellow { background-color: #facc15; color: #000; }
  .red { background-color: #ef4444; color: #fff; }
  button { margin-top: 20px; padding: 8px 14px; cursor: pointer; }
  .actionBtn { background-color: #22C55F; color: white; border: none; padding: 8px 14px; margin-left: 8px; border-radius: 6px; cursor: pointer; font-size: 14px; }
  .actionBtn:hover { background-color: #16a34a; }
</style>
</head>
<body>
<header>
  <img src="MusicMojo logo.png" alt="MusicMojo Logo">
  <h1>MusicMojo</h1>
</header>

<label for="classSelector">Select Class:</label>
<select id="classSelector"></select>
<button id="renameClass" class="actionBtn">✏️ Rename Class</button>
<button id="newClass" class="actionBtn">+ New Class</button>
<button id="addStudent" class="actionBtn">+ Add Student</button>

<div id="canvas"></div>

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // ----- Firebase config -----
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ----- DOM elements -----
  const classSelector = document.getElementById("classSelector");
  const renameClassBtn = document.getElementById("renameClass");
  const newClassBtn = document.getElementById("newClass");
  const addStudentBtn = document.getElementById("addStudent");
  const canvas = document.getElementById("canvas");

  let classes = {};
  let currentClass = "";
  
  // ----- Load classes from Firestore -----
  async function loadClasses() {
    const snapshot = await db.collection("classes").get();
    classes = {};
    snapshot.forEach(doc => classes[doc.id] = doc.data().students || []);
    if (Object.keys(classes).length === 0) {
      // Create default class if empty
      classes["Class 1"] = [];
      await db.collection("classes").doc("Class 1").set({ students: [] });
    }
    buildDropdown();
  }

  function buildDropdown() {
    classSelector.innerHTML = "";
    Object.keys(classes).forEach(cls => {
      const option = document.createElement("option");
      option.value = cls;
      option.textContent = cls;
      classSelector.appendChild(option);
    });
    currentClass = classSelector.value || Object.keys(classes)[0];
    renderStudents();
  }

  classSelector.addEventListener("change", () => {
    currentClass = classSelector.value;
    renderStudents();
  });

  renameClassBtn.addEventListener("click", async () => {
    const newName = prompt("Enter new class name:", currentClass);
    if (!newName || classes[newName]) return alert("Invalid or duplicate class name!");
    classes[newName] = classes[currentClass];
    delete classes[currentClass];
    await db.collection("classes").doc(newName).set({ students: classes[newName] });
    await db.collection("classes").doc(currentClass).delete();
    currentClass = newName;
    buildDropdown();
  });

  newClassBtn.addEventListener("click", async () => {
    const name = prompt("Enter name for new class:");
    if (!name || classes[name]) return alert("Invalid or duplicate class name!");
    classes[name] = [];
    currentClass = name;
    buildDropdown();
    await db.collection("classes").doc(name).set({ students: [] });
    alert(`Class "${name}" created!`);
  });

  addStudentBtn.addEventListener("click", async () => {
    const students = classes[currentClass];
    const newStudent = { name: "New Student", color: "green", x: 50, y: 50 };
    students.push(newStudent);
    await db.collection("classes").doc(currentClass).set({ students });
    renderStudents();
  });

  function renderStudents() {
    canvas.innerHTML = "";
    const students = classes[currentClass] || [];
    students.forEach((student, index) => {
      const div = document.createElement("div");
      div.className = `student ${student.color}`;
      div.style.left = student.x + "px";
      div.style.top = student.y + "px";
      div.innerHTML = `<div style="font-weight:bold">${index+1}</div><div>${student.name}</div>`;
      canvas.appendChild(div);

      // Draggable
      let offsetX, offsetY, isDragging = false;
      div.addEventListener("mousedown", e => {
        isDragging = true;
        offsetX = e.clientX - div.offsetLeft;
        offsetY = e.clientY - div.offsetTop;
      });
      document.addEventListener("mousemove", e => {
        if (isDragging) {
          student.x = e.clientX - offsetX;
          student.y = e.clientY - offsetY;
          div.style.left = student.x + "px";
          div.style.top = student.y + "px";
        }
      });
      document.addEventListener("mouseup", async () => {
        if (isDragging) {
          isDragging = false;
          await db.collection("classes").doc(currentClass).set({ students });
        }
      });
    });
  }

  loadClasses();
</script>
</body>
</html>
